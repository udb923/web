<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Сума прописом (грн/коп)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background:#f6f7fb; color:#111; }
    .wrap { max-width: 820px; margin: 32px auto; padding: 0 16px; }
    .card { background:#fff; border-radius: 16px; padding: 20px; box-shadow: 0 6px 20px rgba(0,0,0,.08); }
    h1 { font-size: 18px; margin: 0 0 14px; }
    .row { display:flex; gap: 10px; flex-wrap: wrap; }
    input, button, textarea {
      font: inherit; border-radius: 12px; border: 1px solid #d7dbe7; padding: 12px 14px;
    }
    input { flex: 1 1 260px; }
    button { cursor: pointer; background:#111; color:#fff; border-color:#111; }
    button.secondary { background:#fff; color:#111; }
    textarea { width: 100%; min-height: 86px; resize: vertical; margin-top: 12px; }
    .hint { font-size: 12px; color:#555; margin-top: 10px; }
    .err { color:#b00020; font-size: 12px; margin-top: 8px; min-height: 16px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Сума прописом (UAH):</h1>

      <form id="f" class="row" autocomplete="off">
        <input id="amount" inputmode="decimal" placeholder="Напр.: 63505.50 або 63 505,50" />
        <button type="submit">Перетворити</button>
        <button type="button" class="secondary" id="copy">Копіювати</button>
      </form>

      <div class="err" id="err"></div>

      <textarea id="out" readonly placeholder="Тут з’явиться результат..."></textarea>
      <div class="hint">Підтримує крапку або кому як роздільник копійок. Копійки завжди 2 цифри.</div>
    </div>
  </div>

<script>
(() => {
  const elAmount = document.getElementById('amount');
  const elOut = document.getElementById('out');
  const elErr = document.getElementById('err');
  const elCopy = document.getElementById('copy');
  const form = document.getElementById('f');

  const HUNDREDS = ["", "сто", "двісті", "триста", "чотириста", "п'ятсот", "шістсот", "сімсот", "вісімсот", "дев'ятсот"];
  const TENS     = ["", "", "двадцять", "тридцять", "сорок", "п'ятдесят", "шістдесят", "сімдесят", "вісімдесят", "дев'яносто"];
  const TEENS    = ["десять", "одинадцять", "дванадцять", "тринадцять", "чотирнадцять", "п'ятнадцять", "шістнадцять", "сімнадцять", "вісімнадцять", "дев'ятнадцять"];
  const UNITS_M  = ["", "один", "два", "три", "чотири", "п'ять", "шість", "сім", "вісім", "дев'ять"];
  const UNITS_F  = ["", "одна", "дві", "три", "чотири", "п'ять", "шість", "сім", "вісім", "дев'ять"];

  const SCALES = [
    { forms: ["", "", ""], gender: "f" }, // units triad (align with "гривня" feminine for "одна/дві")
    { forms: ["тисяча", "тисячі", "тисяч"], gender: "f" },
    { forms: ["мільйон", "мільйони", "мільйонів"], gender: "m" },
    { forms: ["мільярд", "мільярди", "мільярдів"], gender: "m" },
    { forms: ["трильйон", "трильйони", "трильйонів"], gender: "m" },
  ];

  function pluralForm(n, forms3) {
    // Ukrainian plural rules: 1 -> singular; 2-4 -> paucal; 5-9/0 or 11-14 -> plural
    const nAbs = Math.abs(n);
    const last2 = nAbs % 100;
    if (last2 >= 11 && last2 <= 14) return forms3[2];
    const last = nAbs % 10;
    if (last === 1) return forms3[0];
    if (last >= 2 && last <= 4) return forms3[1];
    return forms3[2];
  }

  function triadToWords(n, gender /* 'm' | 'f' */) {
    n = Number(n);
    if (!Number.isFinite(n) || n < 0 || n > 999) return "";
    if (n === 0) return "";

    const h = Math.floor(n / 100);
    const t = Math.floor((n % 100) / 10);
    const u = n % 10;

    const words = [];
    if (h) words.push(HUNDREDS[h]);

    if (t === 1) {
      words.push(TEENS[u]);
    } else {
      if (t) words.push(TENS[t]);
      if (u) words.push((gender === "f" ? UNITS_F : UNITS_M)[u]);
    }
    return words.join(" ");
  }

  function normalizeAmount(raw) {
    // returns { sign, intStr, kopStr } or throws
    if (raw == null) throw new Error("Введіть суму.");
    let s = String(raw).trim();
    if (!s) throw new Error("Введіть суму.");

    // remove spaces and apostrophes-like
    s = s.replace(/\s+/g, "");
    // allow comma decimal
    s = s.replace(",", ".");

    const m = s.match(/^(-)?(\d+)(?:\.(\d{0,}))?$/);
    if (!m) throw new Error("Невірний формат. Приклад: 63505.50");

    const sign = m[1] ? -1 : 1;
    let intStr = m[2].replace(/^0+(?=\d)/, ""); // keep one zero if all zeros
    let frac = (m[3] ?? "");
    if (frac.length > 2) frac = frac.slice(0, 2); // truncate extra digits
    while (frac.length < 2) frac += "0";

    // handle huge numbers by keeping int as string; triads parse as ints later
    return { sign, intStr, kopStr: frac };
  }

  function intStrToWordsUA(intStr) {
    if (intStr === "0") return "нуль";

    // split into triads from right
    const triads = [];
    for (let i = intStr.length; i > 0; i -= 3) {
      triads.unshift(intStr.slice(Math.max(0, i - 3), i));
    }

    if (triads.length > SCALES.length) {
      throw new Error("Занадто велике число для цього конвертера.");
    }

    const parts = [];
    const triadCount = triads.length;

    for (let i = 0; i < triadCount; i++) {
      const triadNum = parseInt(triads[i], 10);
      if (!triadNum) continue;

      const scaleIndex = (triadCount - 1) - i; // 0=units,1=thousand,2=million...
      const scale = SCALES[scaleIndex] || { forms:["","",""], gender:"m" };

      const w = triadToWords(triadNum, scale.gender);
      if (w) parts.push(w);

      if (scaleIndex > 0) {
        parts.push(pluralForm(triadNum, scale.forms));
      }
    }

    return parts.join(" ").replace(/\s+/g, " ").trim();
  }

  function capitalizeFirst(s) {
    return s ? s[0].toUpperCase() + s.slice(1) : s;
  }

  function toTextUAH(raw) {
    const { sign, intStr, kopStr } = normalizeAmount(raw);
    const intWords = intStrToWordsUA(intStr);
    const prefix = sign < 0 ? "мінус " : "";
    return capitalizeFirst((prefix + intWords).trim()) + " грн. " + kopStr + " коп.";
  }

  function convert() {
    elErr.textContent = "";
    try {
      const res = toTextUAH(elAmount.value);
      elOut.value = res;
    } catch (e) {
      elOut.value = "";
      elErr.textContent = e?.message || "Помилка.";
    }
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    convert();
  });

  elAmount.addEventListener('input', () => {
    // live convert, but don't be noisy on empty
    if (!elAmount.value.trim()) { elOut.value = ""; elErr.textContent = ""; return; }
    convert();
  });

  elCopy.addEventListener('click', async () => {
    if (!elOut.value) return;
    try {
      await navigator.clipboard.writeText(elOut.value);
    } catch (_) {
      // fallback
      elOut.focus();
      elOut.select();
      document.execCommand('copy');
      elOut.setSelectionRange(0, 0);
    }
  });

  // demo value
  elAmount.value = "63505.50";
  convert();
})();
</script>
</body>
</html>

